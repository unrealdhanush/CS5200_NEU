"0","library(xml2)"
"0","library(dplyr)"
"0","library(DBI)"
"0","library(purrr)"
"0","# Load XML data"
"0","xml_data <- read_xml(""Books-v4.xml"")"
"0",""
"0","# Extract data from XML"
"0","genres <- xml_data %>%"
"0","  xml_find_all("".//genre"") %>%"
"0","  xml_text() %>%"
"0","  unique() %>%"
"0","  enframe(name = NULL, value = ""Genre"") %>%"
"0","  mutate(GenreID = row_number())"
"0",""
"0","books <- xml_data %>%"
"0","  xml_find_all("".//book"") %>%"
"0","  map_df(~list("
"0","    BookID = xml_attr(.x, ""id""),"
"0","    Title = xml_find_first(.x, "".//title"") %>% xml_text(),"
"0","    Genre = xml_find_first(.x, "".//genre"") %>% xml_text(),"
"0","    Price = xml_find_first(.x, "".//price"") %>% xml_text() %>% as.numeric(),"
"0","    PublishDate = xml_find_first(.x, "".//publish_date"") %>% xml_text(),"
"0","    Description = xml_find_first(.x, "".//description"") %>% xml_text()"
"0","  ))"
"0",""
"0","authors <- xml_data %>%"
"0","  xml_find_all("".//book/author"") %>%"
"0","  xml_text() %>%"
"0","  unique() %>%"
"0","  enframe(name = NULL, value = ""AuthorName"") %>%"
"0","  mutate(AuthorID = row_number())"
"0",""
"0","book_authors <- xml_data %>%"
"0","  xml_find_all("".//book"") %>%"
"0","  map_df(~list("
"0","    BookID = xml_attr(.x, ""id""),"
"0","    AuthorName = xml_find_all(.x, "".//author"") %>% xml_text()"
"0","  )) %>%"
"0","  left_join(authors, by = ""AuthorName"") %>%"
"0","  select(-AuthorName)"
"0",""
"0","# Insert data into the database"
"0","dbWriteTable(con, ""Genre"", genres, row.names = FALSE, overwrite = TRUE)"
"0","dbWriteTable(con, ""Book"", books, row.names = FALSE, overwrite = TRUE)"
"0","dbWriteTable(con, ""Author"", authors, row.names = FALSE, overwrite = TRUE)"
"0","dbWriteTable(con, ""BookAuthor"", book_authors, row.names = FALSE, overwrite = TRUE)"
"0",""
